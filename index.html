<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1">


    <title>Login</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <style type="text/css">
        body {
            background: url(./images/mainpage_background.jpg);
            background-color: #444;
            background-repeat: no-repeat;
            background-size: cover;
        }

        .vertical-offset-100 {
            padding-top: 100px;
        }
    </style>

</head>
<body class="text-center">
<!--<div class="jumbotron">-->
    <!--<h1>Iot Device Management</h1>-->
    <!--<p>Resize this responsive page to see the effect!</p>-->
<!--</div>-->

<div class="container">


    <div class="row" style="height:300px;">
        <div class="col-lg-12">
            <nav class="navbar navbar-default navbar-fixed-top">

                    <div class="navbar-header">
                        <a class="navbar-brand" href="#">IoT Device Management</a>
                    </div>
                    <ul class="nav navbar-nav">

                    </ul>

            </nav>
        </div>

    </div>
    <div class="row position-relative">
        <div class="col-lg-8">

        </div>
        <div class="col-lg-4">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4>Login</h4>
                </div>

                <div class="panel-body">
                    <form>
                        <div class="form-group">
                            <div class="input-group">
                                <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
                                <input id="email" type="text" class="form-control" name="email" placeholder="Email">
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="input-group">
                                <span class="input-group-addon"><i class="glyphicon glyphicon-lock"></i></span>
                                <input id="password" type="password" class="form-control" name="password"
                                       placeholder="Password">
                            </div>
                        </div>
                        <div class="checkbox">
                            <label><input type="checkbox"> Remember me</label>
                        </div>
                        <!--<button type="submit" class="btn btn-default" onclick="return sendloginReq();">Submit</button>-->
                    </form>
                    <button type="submit" class="btn btn-default" onclick="return sendloginReq();">Login</button>


                </div>


            </div>

        </div>
    </div>
    <div class="row">
        <div class="col-sm-4">

        </div>
        <div class="col-sm-4">

        </div>
        <div class="col-sm-4">

        </div>
    </div>
</div>

<script>
    function sendloginReq() {
        console.log("will send soon");
        var base64encoded = "Basic" + " " + btoa(document.getElementsByName('email')[0].value + ":" + document.getElementsByName('password')[0].value);
        // var base64encoded = "Basic" + " " + btoa("kaangoksal@gmail.com" + ":" + "pass-kaan");
        var data = JSON.stringify(false);
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (xhttp.readyState == 4 && xhttp.status == 200) {
                console.log(" Response : " + xhttp.responseText);
                var jsonfile = JSON.parse(xhttp.responseText);
                if (jsonfile["code"] == 31) {
                    alert("Login Failed " + jsonfile["message"]);
                }
                else {
                    localStorage.setItem("email", document.getElementsByName('email')[0].value);
                    localStorage.setItem("username", jsonfile['username']);
                    localStorage.setItem("account_type", jsonfile['account_type']);
                    if (localStorage.getItem("account_type") == "admin") {
                        window.location.replace("admin-dashboard.html");
                    } else if (localStorage.getItem("account_type") == "user") {
                        window.location.replace("dashboard.html");
                    } else {
                        window.location.replace("dashboard.html");
                    }
                }
            }
        };
        xhttp.open("POST", "http://kaangoksal.com:5001/login", true);
        xhttp.setRequestHeader("Content-type", "application/json");
        xhttp.setRequestHeader("Authorization", base64encoded);
        xhttp.send(data);
        console.log("Sent Request");
    }
</script>
</body>
</html>